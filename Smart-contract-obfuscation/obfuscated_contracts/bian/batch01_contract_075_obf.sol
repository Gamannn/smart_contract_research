pragma solidity ^0.4.19;library Ox4aa0b22da918e4265c5e7b53cff61ee49456d3d4 { function Ox203694045fb3bdffbe6f5872036789c49791f783(uint256 Ox3e1f43e492f6a6295e730c7dab19d558500b77e7, uint256 Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2) internal pure returns (uint256) { if (Ox3e1f43e492f6a6295e730c7dab19d558500b77e7 == 0) { return 0; } uint256 Ox70d3b2abdb1364a4f27b553136124617d7e54d2c = Ox3e1f43e492f6a6295e730c7dab19d558500b77e7 * Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2; assert(Ox70d3b2abdb1364a4f27b553136124617d7e54d2c / Ox3e1f43e492f6a6295e730c7dab19d558500b77e7 == Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2); return Ox70d3b2abdb1364a4f27b553136124617d7e54d2c; } function div(uint256 Ox3e1f43e492f6a6295e730c7dab19d558500b77e7, uint256 Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2) internal pure returns (uint256) { uint256 Ox70d3b2abdb1364a4f27b553136124617d7e54d2c = Ox3e1f43e492f6a6295e730c7dab19d558500b77e7 / Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2; return Ox70d3b2abdb1364a4f27b553136124617d7e54d2c; } function sub(uint256 Ox3e1f43e492f6a6295e730c7dab19d558500b77e7, uint256 Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2) internal pure returns (uint256) { assert(Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2 <= Ox3e1f43e492f6a6295e730c7dab19d558500b77e7); return Ox3e1f43e492f6a6295e730c7dab19d558500b77e7 - Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2; } function Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(uint256 Ox3e1f43e492f6a6295e730c7dab19d558500b77e7, uint256 Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2) internal pure returns (uint256) { uint256 Ox70d3b2abdb1364a4f27b553136124617d7e54d2c = Ox3e1f43e492f6a6295e730c7dab19d558500b77e7 + Oxb566b7e0aeb07241e2e42a482ecdc62b74f967c2; assert(Ox70d3b2abdb1364a4f27b553136124617d7e54d2c >= Ox3e1f43e492f6a6295e730c7dab19d558500b77e7); return Ox70d3b2abdb1364a4f27b553136124617d7e54d2c; }}contract Ownable { event OwnershipTransferred(address indexed previousOwner, address indexed newOwner); function Ownable() public { Ox99a6c895f901a780ff2a1904501ad31257ed98c1.owner = msg.sender; } modifier onlyOwner() { require(msg.sender == Ox99a6c895f901a780ff2a1904501ad31257ed98c1.owner); _; } function transferOwnership(address newOwner) public onlyOwner { require(newOwner != address(0)); OwnershipTransferred(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.owner, newOwner); Ox99a6c895f901a780ff2a1904501ad31257ed98c1.owner = newOwner; }}contract Token { function Ox622e63ebd492a2561cb04875347483867b1de462() public view returns (uint256); function Oxc88ee768bfbd373d765bac2ff2023d6f420bed43(address _owner) public view returns (uint256); function Oxb7d06523a3c4dd8cf6b6e020f273dac1dc49c15e(address _to, uint256 _value) public returns (bool); function Ox2779931ade291aa75ae25717eeff07150b9a2376(address _from, address _to, uint256 _value) public returns (bool); function approve(address _spender, uint256 _value) public returns (bool); function allowance(address _owner, address _spender) public view returns (uint256); event Transfer(address indexed _from, address indexed _to, uint256 _value); event Approval(address indexed _owner, address indexed _spender, uint256 _value);}contract FeeModifiersInterface { function accountFeeModifiers(address Ox13557b117953be6b3a406965ab70caed36649463) public view returns (uint256 feeDiscount, uint256 feeRebate); function tradingFeeModifiers(address _maker, address _taker) public view returns (uint256 feeMakeDiscount, uint256 feeTakeDiscount, uint256 feeRebate);}contract TradeTrackerInterface { function tradeEventHandler(address _tokenGet, uint256 _amountGet, address _tokenGive, uint256 _amountGive, address _maker, address Ox13557b117953be6b3a406965ab70caed36649463, bytes32 _orderHash, uint256 _gasLimit) public;}contract ETHERCExchange is Ownable { using Ox4aa0b22da918e4265c5e7b53cff61ee49456d3d4 for uint256; mapping (address => mapping (address => uint256)) public Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce; mapping (bytes32 => bool) public cancelledOrders; mapping (bytes32 => uint256) public orderFills; event Deposit(address token, address user, uint256 amount, uint256 Ox162e40302ad8f25ee821c7308ab7691b3f55c645); event Withdraw(address token, address user, uint256 amount, uint256 Ox162e40302ad8f25ee821c7308ab7691b3f55c645); event Cancel(address tokenGet, uint256 amountGet, address tokenGive, uint256 amountGive, uint256 expires, uint256 nonce, address maker, uint8 v, bytes32 r, bytes32 s, bytes32 orderHash, uint256 amountFilled); event Trade(address tokenGet, uint256 amountGet, address tokenGive, uint256 amountGive, address maker, address taker, bytes32 orderHash); function ETHERCExchange() public { Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeAccount = Ox99a6c895f901a780ff2a1904501ad31257ed98c1.owner; } function() public { revert(); } function getAccountFeeModifiers(address Ox13557b117953be6b3a406965ab70caed36649463) public view returns(uint256 feeDiscount, uint256 feeRebate) { if (Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeModifiers != address(0)) { (feeDiscount, feeRebate) = FeeModifiersInterface(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeModifiers).accountFeeModifiers(Ox13557b117953be6b3a406965ab70caed36649463); } } function deposit() public payable { Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[address(0)][msg.sender] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[address(0)][msg.sender].Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(msg.Ox39dd6c6d9442dc0e8a9ec16cb5bb99e6f52e5e74); Deposit(address(0), msg.sender, msg.Ox39dd6c6d9442dc0e8a9ec16cb5bb99e6f52e5e74, Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[address(0)][msg.sender]); } function depositToken(address _token, uint256 Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6) public { require(_token != address(0)); if (!Token(_token).Ox2779931ade291aa75ae25717eeff07150b9a2376(msg.sender, this, Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6)) revert(); Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_token][msg.sender] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_token][msg.sender].Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6); Deposit(_token, msg.sender, Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6, Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_token][msg.sender]); } function withdraw(uint256 Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6) public { require(Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[address(0)][msg.sender] >= Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6); Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[address(0)][msg.sender] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[address(0)][msg.sender].sub(Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6); msg.sender.Oxb7d06523a3c4dd8cf6b6e020f273dac1dc49c15e(Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6); Withdraw(address(0), msg.sender, Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6, Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[address(0)][msg.sender]); } function withdrawToken(address _token, uint256 Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6) public { require(_token != address(0)); require(Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_token][msg.sender] >= Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6); Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_token][msg.sender] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_token][msg.sender].sub(Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6); if (!Token(_token).Oxb7d06523a3c4dd8cf6b6e020f273dac1dc49c15e(msg.sender, Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6)) revert(); Withdraw(_token, msg.sender, Oxd94545a37e18f1b51f8f4a767d421b6f8e5341d6, Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_token][msg.sender]); } function Oxc88ee768bfbd373d765bac2ff2023d6f420bed43(address _token, address Ox13557b117953be6b3a406965ab70caed36649463) public view returns (uint256) { return Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_token][Ox13557b117953be6b3a406965ab70caed36649463]; } function trade(address _tokenGet, uint256 _amountGet, address _tokenGive, uint256 _amountGive, uint256 _expires, uint256 _nonce, address _maker, uint8 _v, bytes32 _r, bytes32 _s, uint256 _amountTrade) public { uint256 executionGasLimit = msg.gas; bytes32 orderHash = getOrderHash(_tokenGet, _amountGet, _tokenGive, _amountGive, _expires, _nonce, _maker); if (ecrecover(keccak256("\x19Ethereum Signed Message:\n32", orderHash), _v, _r, _s) != _maker || cancelledOrders[orderHash] || block.number > _expires || orderFills[orderHash].Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(_amountTrade) > _amountGet ) revert(); tradeBalances(_tokenGet, _amountGet, _tokenGive, _amountGive, _maker, _amountTrade); orderFills[orderHash] = orderFills[orderHash].Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(_amountTrade); uint256 amountTradeGive = _amountGive.Ox203694045fb3bdffbe6f5872036789c49791f783(_amountTrade) / _amountGet; if(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.tradeTracker != address(0)){ TradeTrackerInterface(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.tradeTracker).tradeEventHandler(_tokenGet, _amountTrade, _tokenGive, amountTradeGive, _maker, msg.sender, orderHash, executionGasLimit); } Trade(_tokenGet, _amountTrade, _tokenGive, amountTradeGive, _maker, msg.sender, orderHash); } function tradeBalances(address _tokenGet, uint256 _amountGet, address _tokenGive, uint256 _amountGive, address _maker, uint256 _amountTrade) private { uint256 feeMakeValue = _amountTrade.Ox203694045fb3bdffbe6f5872036789c49791f783(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeMake) / (1 ether); uint256 feeTakeValue = _amountTrade.Ox203694045fb3bdffbe6f5872036789c49791f783(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeTake) / (1 ether); uint256 feeRebateValue = 0; if (Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeModifiers != address(0)) { uint256 feeMakeDiscount; uint256 feeTakeDiscount; uint256 feeRebate; (feeMakeDiscount, feeTakeDiscount, feeRebate) = FeeModifiersInterface(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeModifiers).tradingFeeModifiers(_maker, msg.sender); if (feeMakeValue > 0 && feeMakeDiscount > 0 && feeMakeDiscount <= 100 ) feeMakeValue = feeMakeValue.Ox203694045fb3bdffbe6f5872036789c49791f783(100 - feeMakeDiscount) / 100; if (feeTakeValue > 0 && feeTakeDiscount > 0 && feeTakeDiscount <= 100 ) feeTakeValue = feeTakeValue.Ox203694045fb3bdffbe6f5872036789c49791f783(100 - feeTakeDiscount) / 100; if (feeTakeValue > 0 && feeRebate > 0 && feeRebate <= 100) feeRebateValue = feeTakeValue.Ox203694045fb3bdffbe6f5872036789c49791f783(feeRebate) / 100; } Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGet][msg.sender] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGet][msg.sender].sub(_amountTrade.Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(feeTakeValue)); Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGet][_maker] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGet][_maker].Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(_amountTrade.sub(feeMakeValue).Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(feeRebateValue)); Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGive][msg.sender] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGive][msg.sender].Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(_amountGive.Ox203694045fb3bdffbe6f5872036789c49791f783(_amountTrade) / _amountGet); Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGive][_maker] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGive][_maker].sub(_amountGive.Ox203694045fb3bdffbe6f5872036789c49791f783(_amountTrade) / _amountGet); Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGet][Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeAccount] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGet][Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeAccount].Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(feeMakeValue.Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(feeTakeValue).sub(feeRebateValue)); } function validateTrade(address _tokenGet, uint256 _amountGet, address _tokenGive, uint256 _amountGive, uint256 _expires, uint256 _nonce, address _maker, uint8 _v, bytes32 _r, bytes32 _s, uint256 _amountTrade, address _taker) public view returns (uint8) { uint256 feeTakeValue = calculateTakerFee(_taker, _amountTrade); if (_amountTrade.Ox667135680ca1cb4e96c80f7e8b1fd8f8d7ad6c35(feeTakeValue) > Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGet][_taker]) return 1; if (availableVolume(_tokenGet, _amountGet, _tokenGive, _amountGive, _expires, _nonce, _maker, _v, _r, _s) < _amountTrade) return 2; return 0; } function calculateTakerFee(address _taker, uint256 _amountTrade) public view returns (uint256) { uint256 feeTakeValue = _amountTrade.Ox203694045fb3bdffbe6f5872036789c49791f783(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeTake) / (1 ether); uint256 feeDiscount; uint256 feeRebate; (feeDiscount, feeRebate) = getAccountFeeModifiers(_taker); if (feeTakeValue > 0 && feeDiscount > 0 && feeDiscount <= 100 ) feeTakeValue = feeTakeValue.Ox203694045fb3bdffbe6f5872036789c49791f783(100 - feeDiscount) / 100; return feeTakeValue; } function getOrderHash(address _tokenGet, uint256 _amountGet, address _tokenGive, uint256 _amountGive, uint256 _expires, uint256 _nonce, address _maker) public view returns (bytes32) { return keccak256(this, _tokenGet, _amountGet, _tokenGive, _amountGive, _expires, _nonce, _maker); } function availableVolume(address _tokenGet, uint256 _amountGet, address _tokenGive, uint256 _amountGive, uint256 _expires, uint256 _nonce, address _maker, uint8 _v, bytes32 _r, bytes32 _s) public view returns (uint256) { bytes32 orderHash = getOrderHash(_tokenGet, _amountGet, _tokenGive, _amountGive, _expires, _nonce, _maker); if (ecrecover(keccak256("\x19Ethereum Signed Message:\n32", orderHash), _v, _r, _s) != _maker || cancelledOrders[orderHash] || block.number > _expires || _amountGet <= orderFills[orderHash] ) return 0; uint256[2] memory available; available[0] = _amountGet.sub(orderFills[orderHash]); available[1] = Ox3fd396eac086f54827fdd134f3fe83f8b14f37ce[_tokenGive][_maker].Ox203694045fb3bdffbe6f5872036789c49791f783(_amountGet) / _amountGive; if (available[0] < available[1]) return available[0]; return available[1]; } function amountFilled(address _tokenGet, uint256 _amountGet, address _tokenGive, uint256 _amountGive, uint256 _expires, uint256 _nonce, address _maker) public view returns (uint256) { bytes32 orderHash = getOrderHash(_tokenGet, _amountGet, _tokenGive, _amountGive, _expires, _nonce, _maker); return orderFills[orderHash]; } function cancelOrder(address _tokenGet, uint256 _amountGet, address _tokenGive, uint256 _amountGive, uint256 _expires, uint256 _nonce, uint8 _v, bytes32 _r, bytes32 _s) public { bytes32 orderHash = getOrderHash(_tokenGet, _amountGet, _tokenGive, _amountGive, _expires, _nonce, msg.sender); if (ecrecover(keccak256("\x19Ethereum Signed Message:\n32", orderHash), _v, _r, _s) != msg.sender) revert(); cancelledOrders[orderHash] = true; Cancel(_tokenGet, _amountGet, _tokenGive, _amountGive, _expires, _nonce, msg.sender, _v, _r, _s, orderHash, orderFills[orderHash]); } function changeFeeAccount(address _feeAccount) public onlyOwner { require(_feeAccount != address(0)); Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeAccount = _feeAccount; } function changeFeeMake(uint256 _feeMake) public onlyOwner { require(_feeMake != Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeMake); Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeMake = _feeMake; } function changeFeeTake(uint256 _feeTake) public onlyOwner { require(_feeTake != Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeTake); Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeTake = _feeTake; } function changeFeeModifiers(address _feeModifiers) public onlyOwner { require(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeModifiers != _feeModifiers); Ox99a6c895f901a780ff2a1904501ad31257ed98c1.feeModifiers = _feeModifiers; } function changeTradeTracker(address _tradeTracker) public onlyOwner { require(Ox99a6c895f901a780ff2a1904501ad31257ed98c1.tradeTracker != _tradeTracker); Ox99a6c895f901a780ff2a1904501ad31257ed98c1.tradeTracker = _tradeTracker; }struct scalar2Vector {uint256 feeTake;uint256 feeMake;address feeAccount;address feeModifiers;address tradeTracker;address owner;}scalar2Vector Ox99a6c895f901a780ff2a1904501ad31257ed98c1 = scalar2Vector(0, 0, address(0), address(0), address(0), address(0));}