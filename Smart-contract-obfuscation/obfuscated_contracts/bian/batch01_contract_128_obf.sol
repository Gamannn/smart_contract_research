pragma solidity ^0.4.9;contract SafeMath { function safeMul(uint a, uint b) internal returns (uint) { uint c = a * b; assert(a == 0 || c / a == b); return c; } function safeSub(uint a, uint b) internal returns (uint) { assert(b <= a); return a - b; } function safeAdd(uint a, uint b) internal returns (uint) { uint c = a + b; assert(c>=a && c>=b); return c; } function assert(bool assertion) internal { if (!assertion) throw; }}contract Token { function Ox65ebec957e54388cc1f2751e88b82dbb6380baff() constant returns (uint256 supply) {} function Ox14629c0c0749d2f063c0d468233607f8eef6b482(address _owner) constant returns (uint256 balance) {} function Ox5c334b5ace91680e452ecd26b0fb5719bd65f7d6(address Ox1a29ac516cf447eb9227401f278bb0c84743b1b6, uint256 Oxc1dc7325de44559975accb8448cf2577e668e947) returns (bool Ox74124b7d5b57b779ab048eae189cd02f6097ffde) {} function Oxa01bea022d276dff41b20e91825855667c12629d(address Oxf5f374e75648b98441058746defc33a89d836f92, address Ox1a29ac516cf447eb9227401f278bb0c84743b1b6, uint256 Oxc1dc7325de44559975accb8448cf2577e668e947) returns (bool Ox74124b7d5b57b779ab048eae189cd02f6097ffde) {} function Oxd92da1af7b3aeee91956e4cc1bf2927df35c2aa5(address Oxf144e158b542e9b4623f421cc520dcbedebf2dc4, uint256 Oxc1dc7325de44559975accb8448cf2577e668e947) returns (bool Ox74124b7d5b57b779ab048eae189cd02f6097ffde) {} function Oxd35a3b5625110955766c4bbce46cb0a27bf8579f(address _owner, address Oxf144e158b542e9b4623f421cc520dcbedebf2dc4) constant returns (uint256 remaining) {} event Transfer(address indexed Oxf5f374e75648b98441058746defc33a89d836f92, address indexed Ox1a29ac516cf447eb9227401f278bb0c84743b1b6, uint256 Oxc1dc7325de44559975accb8448cf2577e668e947); event Approval(address indexed _owner, address indexed Oxf144e158b542e9b4623f421cc520dcbedebf2dc4, uint256 Oxc1dc7325de44559975accb8448cf2577e668e947); string public Oxdff2bce4b1fa9cc3c1f8ca6cea5adf38eb57dccd;}contract StandardToken is Token { function Ox5c334b5ace91680e452ecd26b0fb5719bd65f7d6(address Ox1a29ac516cf447eb9227401f278bb0c84743b1b6, uint256 Oxc1dc7325de44559975accb8448cf2577e668e947) returns (bool Ox74124b7d5b57b779ab048eae189cd02f6097ffde) { if (balances[msg.sender] >= Oxc1dc7325de44559975accb8448cf2577e668e947 && balances[Ox1a29ac516cf447eb9227401f278bb0c84743b1b6] + Oxc1dc7325de44559975accb8448cf2577e668e947 > balances[Ox1a29ac516cf447eb9227401f278bb0c84743b1b6]) { balances[msg.sender] -= Oxc1dc7325de44559975accb8448cf2577e668e947; balances[Ox1a29ac516cf447eb9227401f278bb0c84743b1b6] += Oxc1dc7325de44559975accb8448cf2577e668e947; Transfer(msg.sender, Ox1a29ac516cf447eb9227401f278bb0c84743b1b6, Oxc1dc7325de44559975accb8448cf2577e668e947); return true; } else { return false; } } function Oxa01bea022d276dff41b20e91825855667c12629d(address Oxf5f374e75648b98441058746defc33a89d836f92, address Ox1a29ac516cf447eb9227401f278bb0c84743b1b6, uint256 Oxc1dc7325de44559975accb8448cf2577e668e947) returns (bool Ox74124b7d5b57b779ab048eae189cd02f6097ffde) { if (balances[Oxf5f374e75648b98441058746defc33a89d836f92] >= Oxc1dc7325de44559975accb8448cf2577e668e947 && allowed[Oxf5f374e75648b98441058746defc33a89d836f92][msg.sender] >= Oxc1dc7325de44559975accb8448cf2577e668e947 && balances[Ox1a29ac516cf447eb9227401f278bb0c84743b1b6] + Oxc1dc7325de44559975accb8448cf2577e668e947 > balances[Ox1a29ac516cf447eb9227401f278bb0c84743b1b6]) { balances[Ox1a29ac516cf447eb9227401f278bb0c84743b1b6] += Oxc1dc7325de44559975accb8448cf2577e668e947; balances[Oxf5f374e75648b98441058746defc33a89d836f92] -= Oxc1dc7325de44559975accb8448cf2577e668e947; allowed[Oxf5f374e75648b98441058746defc33a89d836f92][msg.sender] -= Oxc1dc7325de44559975accb8448cf2577e668e947; Transfer(Oxf5f374e75648b98441058746defc33a89d836f92, Ox1a29ac516cf447eb9227401f278bb0c84743b1b6, Oxc1dc7325de44559975accb8448cf2577e668e947); return true; } else { return false; } } function Ox14629c0c0749d2f063c0d468233607f8eef6b482(address _owner) constant returns (uint256 balance) { return balances[_owner]; } function Oxd92da1af7b3aeee91956e4cc1bf2927df35c2aa5(address Oxf144e158b542e9b4623f421cc520dcbedebf2dc4, uint256 Oxc1dc7325de44559975accb8448cf2577e668e947) returns (bool Ox74124b7d5b57b779ab048eae189cd02f6097ffde) { allowed[msg.sender][Oxf144e158b542e9b4623f421cc520dcbedebf2dc4] = Oxc1dc7325de44559975accb8448cf2577e668e947; Approval(msg.sender, Oxf144e158b542e9b4623f421cc520dcbedebf2dc4, Oxc1dc7325de44559975accb8448cf2577e668e947); return true; } function Oxd35a3b5625110955766c4bbce46cb0a27bf8579f(address _owner, address Oxf144e158b542e9b4623f421cc520dcbedebf2dc4) constant returns (uint256 remaining) { return allowed[_owner][Oxf144e158b542e9b4623f421cc520dcbedebf2dc4]; } mapping(address => uint256) balances; mapping (address => mapping (address => uint256)) allowed; }contract ReserveToken is StandardToken, SafeMath { function ReserveToken() { Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.minter = msg.sender; } function create(address account, uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) { if (msg.sender != Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.minter) throw; balances[account] = safeAdd(balances[account], Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732); Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.Ox65ebec957e54388cc1f2751e88b82dbb6380baff = safeAdd(Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.Ox65ebec957e54388cc1f2751e88b82dbb6380baff, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732); } function destroy(address account, uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) { if (msg.sender != Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.minter) throw; if (balances[account] < Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) throw; balances[account] = safeSub(balances[account], Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732); Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.Ox65ebec957e54388cc1f2751e88b82dbb6380baff = safeSub(Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.Ox65ebec957e54388cc1f2751e88b82dbb6380baff, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732); }}contract AccountLevels { function accountLevel(address user) constant returns(uint) {}}contract AccountLevelsTest is AccountLevels { mapping (address => uint) public accountLevels; function setAccountLevel(address user, uint level) { accountLevels[user] = level; } function accountLevel(address user) constant returns(uint) { return accountLevels[user]; }}contract BITOX is SafeMath { mapping (address => mapping (address => uint)) public tokens; mapping (address => mapping (bytes32 => bool)) public orders; mapping (address => mapping (bytes32 => uint)) public orderFills; event Order(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user); event Cancel(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s); event Trade(address tokenGet, uint amountGet, address tokenGive, uint amountGive, address get, address give); event Deposit(address token, address user, uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, uint balance); event Withdraw(address token, address user, uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, uint balance); function BITOX(address admin_, address feeAccount_, address feeAccount2_, address accountLevelsAddr_, uint feeMake_, uint feeTake_, uint feeRebate_) { Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.admin = admin_; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeAccount = feeAccount_; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeAccount2 = feeAccount2_; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.accountLevelsAddr = accountLevelsAddr_; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeMake = feeMake_; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeTake = feeTake_; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeRebate = feeRebate_; } function() { throw; } function changeAdmin(address admin_) { if (msg.sender != Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.admin) throw; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.admin = admin_; } function changeAccountLevelsAddr(address accountLevelsAddr_) { if (msg.sender != Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.admin) throw; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.accountLevelsAddr = accountLevelsAddr_; } function changeFeeAccount(address feeAccount_) { if (msg.sender != Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.admin) throw; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeAccount = feeAccount_; } function changeFeeAccount2(address feeAccount2_) { if (msg.sender != Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeAccount2) throw; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeAccount2 = feeAccount2_; } function changeFeeMake(uint feeMake_) { if (msg.sender != Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.admin) throw; if (feeMake_ > Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeMake) throw; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeMake = feeMake_; } function changeFeeTake(uint feeTake_) { if (msg.sender != Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.admin) throw; if (feeTake_ > Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeTake || feeTake_ < Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeRebate) throw; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeTake = feeTake_; } function changeFeeRebate(uint feeRebate_) { if (msg.sender != Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.admin) throw; if (feeRebate_ < Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeRebate || feeRebate_ > Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeTake) throw; Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeRebate = feeRebate_; } function deposit() payable { tokens[0][msg.sender] = safeAdd(tokens[0][msg.sender], msg.Ox798cc36ba431090fcf30caaf39ae210c655ca84d); Deposit(0, msg.sender, msg.Ox798cc36ba431090fcf30caaf39ae210c655ca84d, tokens[0][msg.sender]); } function withdraw(uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) { if (tokens[0][msg.sender] < Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) throw; tokens[0][msg.sender] = safeSub(tokens[0][msg.sender], Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732); if (!msg.sender.call.Ox798cc36ba431090fcf30caaf39ae210c655ca84d(Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732)()) throw; Withdraw(0, msg.sender, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, tokens[0][msg.sender]); } function depositToken(address token, uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) { if (token==0) throw; if (!Token(token).Oxa01bea022d276dff41b20e91825855667c12629d(msg.sender, this, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732)) throw; tokens[token][msg.sender] = safeAdd(tokens[token][msg.sender], Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732); Deposit(token, msg.sender, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, tokens[token][msg.sender]); } function withdrawToken(address token, uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) { if (token==0) throw; if (tokens[token][msg.sender] < Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) throw; tokens[token][msg.sender] = safeSub(tokens[token][msg.sender], Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732); if (!Token(token).Ox5c334b5ace91680e452ecd26b0fb5719bd65f7d6(msg.sender, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732)) throw; Withdraw(token, msg.sender, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, tokens[token][msg.sender]); } function Ox14629c0c0749d2f063c0d468233607f8eef6b482(address token, address user) constant returns (uint) { return tokens[token][user]; } function order(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); orders[msg.sender][hash] = true; Order(tokenGet, amountGet, tokenGive, amountGive, expires, nonce, msg.sender); } function trade(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s, uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); if (!( (orders[user][hash] || ecrecover(sha3("\x19Ethereum Signed Message:\n32", hash),v,r,s) == user) && block.number <= expires && safeAdd(orderFills[user][hash], Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) <= amountGet )) throw; tradeBalances(tokenGet, amountGet, tokenGive, amountGive, user, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732); orderFills[user][hash] = safeAdd(orderFills[user][hash], Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732); Trade(tokenGet, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, tokenGive, amountGive * Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732 / amountGet, user, msg.sender); } function tradeBalances(address tokenGet, uint amountGet, address tokenGive, uint amountGive, address user, uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) private { uint feeMakeXfer = safeMul(Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeMake) / (1 ether); uint feeTakeXfer = safeMul(Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeTake) / (1 ether); uint feeRebateXfer = 0; if (Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.accountLevelsAddr != 0x0) { uint accountLevel = AccountLevels(Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.accountLevelsAddr).accountLevel(user); if (accountLevel==1) feeRebateXfer = safeMul(Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeRebate) / (1 ether); if (accountLevel==2) feeRebateXfer = feeTakeXfer; } tokens[tokenGet][msg.sender] = safeSub(tokens[tokenGet][msg.sender], safeAdd(Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, feeTakeXfer)); tokens[tokenGet][user] = safeAdd(tokens[tokenGet][user], safeSub(safeAdd(Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, feeRebateXfer), feeMakeXfer)); uint fee = safeSub(safeAdd(feeMakeXfer, feeTakeXfer), feeRebateXfer); uint fee2 = safeMul(fee, 20) / 100; tokens[tokenGet][Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeAccount] = safeAdd(tokens[tokenGet][Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeAccount], safeSub(fee, fee2)); tokens[tokenGet][Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeAccount2] = safeAdd(tokens[tokenGet][Oxfd44f6baaad3b2297d68314dba213a38d3daeff4.feeAccount2], fee2); tokens[tokenGive][user] = safeSub(tokens[tokenGive][user], safeMul(amountGive, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) / amountGet); tokens[tokenGive][msg.sender] = safeAdd(tokens[tokenGive][msg.sender], safeMul(amountGive, Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732) / amountGet); } function testTrade(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s, uint Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732, address sender) constant returns(bool) { if (!( tokens[tokenGet][sender] >= Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732 && availableVolume(tokenGet, amountGet, tokenGive, amountGive, expires, nonce, user, v, r, s) >= Ox0f1cbce4a4c8744d0d35e537374f1aac451f2732 )) return false; return true; } function availableVolume(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s) constant returns(uint) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); if (!( (orders[user][hash] || ecrecover(sha3("\x19Ethereum Signed Message:\n32", hash),v,r,s) == user) && block.number <= expires )) return 0; uint available1 = safeSub(amountGet, orderFills[user][hash]); uint available2 = safeMul(tokens[tokenGive][user], amountGet) / amountGive; if (available1<available2) return available1; return available2; } function amountFilled(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s) constant returns(uint) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); return orderFills[user][hash]; } function cancelOrder(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, uint8 v, bytes32 r, bytes32 s) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); if (!(orders[msg.sender][hash] || ecrecover(sha3("\x19Ethereum Signed Message:\n32", hash),v,r,s) == msg.sender)) throw; orderFills[msg.sender][hash] = amountGet; Cancel(tokenGet, amountGet, tokenGive, amountGive, expires, nonce, msg.sender, v, r, s); }struct scalar2Vector {uint256 feeRebate;uint256 feeTake;uint256 feeMake;address accountLevelsAddr;address feeAccount2;address feeAccount;address admin;address minter;uint256 Ox65ebec957e54388cc1f2751e88b82dbb6380baff;uint256 Ox1912ba67fd17857ede5060326e9b75fb66d75b95;}scalar2Vector Oxfd44f6baaad3b2297d68314dba213a38d3daeff4 = scalar2Vector(0, 0, 0, address(0), address(0), address(0), address(0), address(0), 0, 0);}