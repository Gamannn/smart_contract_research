pragma solidity ^0.4.9;contract Ox9ddd03cfebe313ba94fe900223329b3354dcc32b { function safeMul(uint Ox8f704d1d5946fa6b9f904470f932369ede93067f, uint Oxd70e5dc7194e2e6596d78849cbb67e43bff547a7) internal returns (uint) { uint Oxecc35629e4fc67b0b17b87ced4a1ad267032adef = Ox8f704d1d5946fa6b9f904470f932369ede93067f * Oxd70e5dc7194e2e6596d78849cbb67e43bff547a7; assert(Ox8f704d1d5946fa6b9f904470f932369ede93067f == 0 || Oxecc35629e4fc67b0b17b87ced4a1ad267032adef / Ox8f704d1d5946fa6b9f904470f932369ede93067f == Oxd70e5dc7194e2e6596d78849cbb67e43bff547a7); return Oxecc35629e4fc67b0b17b87ced4a1ad267032adef; } function safeSub(uint Ox8f704d1d5946fa6b9f904470f932369ede93067f, uint Oxd70e5dc7194e2e6596d78849cbb67e43bff547a7) internal returns (uint) { assert(Oxd70e5dc7194e2e6596d78849cbb67e43bff547a7 <= Ox8f704d1d5946fa6b9f904470f932369ede93067f); return Ox8f704d1d5946fa6b9f904470f932369ede93067f - Oxd70e5dc7194e2e6596d78849cbb67e43bff547a7; } function safeAdd(uint Ox8f704d1d5946fa6b9f904470f932369ede93067f, uint Oxd70e5dc7194e2e6596d78849cbb67e43bff547a7) internal returns (uint) { uint Oxecc35629e4fc67b0b17b87ced4a1ad267032adef = Ox8f704d1d5946fa6b9f904470f932369ede93067f + Oxd70e5dc7194e2e6596d78849cbb67e43bff547a7; assert(Oxecc35629e4fc67b0b17b87ced4a1ad267032adef>=Ox8f704d1d5946fa6b9f904470f932369ede93067f && Oxecc35629e4fc67b0b17b87ced4a1ad267032adef>=Oxd70e5dc7194e2e6596d78849cbb67e43bff547a7); return Oxecc35629e4fc67b0b17b87ced4a1ad267032adef; } function assert(bool assertion) internal { if (!assertion) throw; }}contract Token { function Oxbc4c013090dcdd0d919102992e480603c6d7b075() constant returns (uint256 supply) {} function Oxab222344dad4862728db0dfd7feec8c4dfac26dd(address Ox30284b47471ac1d4534abb1fcc0ad4f5dcdf29c3) constant returns (uint256 Ox0197f6b08d7f63ce9af55e1682937d27d0e742a5) {} function Ox5b711cb427875f377563639a8ae06938b559fb07(address Ox283bc9cc09145fe026b0587405a7150c8576182a, uint256 Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e) returns (bool success) {} function Ox0029c064b3534a5b521718c1c0a2871f14814bc9(address Oxf4f7acc9d9fe2fa89eadf8d804b8a18bdef56059, address Ox283bc9cc09145fe026b0587405a7150c8576182a, uint256 Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e) returns (bool success) {} function Oxd7804c83b4426656831785fc042d8e40bf4e12cb(address Oxf9a3f98fcba8256544131eb3ec23863ec64aa39a, uint256 Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e) returns (bool success) {} function Ox54338761bb91b9401dca6edd566e41f5cb113947(address Ox30284b47471ac1d4534abb1fcc0ad4f5dcdf29c3, address Oxf9a3f98fcba8256544131eb3ec23863ec64aa39a) constant returns (uint256 remaining) {} event Transfer(address indexed Oxf4f7acc9d9fe2fa89eadf8d804b8a18bdef56059, address indexed Ox283bc9cc09145fe026b0587405a7150c8576182a, uint256 Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e); event Approval(address indexed Ox30284b47471ac1d4534abb1fcc0ad4f5dcdf29c3, address indexed Oxf9a3f98fcba8256544131eb3ec23863ec64aa39a, uint256 Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e); string public Ox4080643c6180cb25ab4176ebc3ed91aaeb2089f7;}contract Ox4c74b0cb1c912d9f6ddbcf473be14b67ae6c42b8 is Token { function Ox5b711cb427875f377563639a8ae06938b559fb07(address Ox283bc9cc09145fe026b0587405a7150c8576182a, uint256 Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e) returns (bool success) { if (Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[msg.sender] >= Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e && Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[Ox283bc9cc09145fe026b0587405a7150c8576182a] + Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e > Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[Ox283bc9cc09145fe026b0587405a7150c8576182a]) { Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[msg.sender] -= Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e; Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[Ox283bc9cc09145fe026b0587405a7150c8576182a] += Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e; Transfer(msg.sender, Ox283bc9cc09145fe026b0587405a7150c8576182a, Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e); return true; } else { return false; } } function Ox0029c064b3534a5b521718c1c0a2871f14814bc9(address Oxf4f7acc9d9fe2fa89eadf8d804b8a18bdef56059, address Ox283bc9cc09145fe026b0587405a7150c8576182a, uint256 Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e) returns (bool success) { if (Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[Oxf4f7acc9d9fe2fa89eadf8d804b8a18bdef56059] >= Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e && Ox52dbedeb4076f50de93275011c636bbe557fe366[Oxf4f7acc9d9fe2fa89eadf8d804b8a18bdef56059][msg.sender] >= Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e && Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[Ox283bc9cc09145fe026b0587405a7150c8576182a] + Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e > Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[Ox283bc9cc09145fe026b0587405a7150c8576182a]) { Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[Ox283bc9cc09145fe026b0587405a7150c8576182a] += Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e; Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[Oxf4f7acc9d9fe2fa89eadf8d804b8a18bdef56059] -= Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e; Ox52dbedeb4076f50de93275011c636bbe557fe366[Oxf4f7acc9d9fe2fa89eadf8d804b8a18bdef56059][msg.sender] -= Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e; Transfer(Oxf4f7acc9d9fe2fa89eadf8d804b8a18bdef56059, Ox283bc9cc09145fe026b0587405a7150c8576182a, Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e); return true; } else { return false; } } function Oxab222344dad4862728db0dfd7feec8c4dfac26dd(address Ox30284b47471ac1d4534abb1fcc0ad4f5dcdf29c3) constant returns (uint256 Ox0197f6b08d7f63ce9af55e1682937d27d0e742a5) { return Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[Ox30284b47471ac1d4534abb1fcc0ad4f5dcdf29c3]; } function Oxd7804c83b4426656831785fc042d8e40bf4e12cb(address Oxf9a3f98fcba8256544131eb3ec23863ec64aa39a, uint256 Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e) returns (bool success) { Ox52dbedeb4076f50de93275011c636bbe557fe366[msg.sender][Oxf9a3f98fcba8256544131eb3ec23863ec64aa39a] = Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e; Approval(msg.sender, Oxf9a3f98fcba8256544131eb3ec23863ec64aa39a, Ox8e5020d0fc0fb6f4c1eda3d0edf12712eeaadd7e); return true; } function Ox54338761bb91b9401dca6edd566e41f5cb113947(address Ox30284b47471ac1d4534abb1fcc0ad4f5dcdf29c3, address Oxf9a3f98fcba8256544131eb3ec23863ec64aa39a) constant returns (uint256 remaining) { return Ox52dbedeb4076f50de93275011c636bbe557fe366[Ox30284b47471ac1d4534abb1fcc0ad4f5dcdf29c3][Oxf9a3f98fcba8256544131eb3ec23863ec64aa39a]; } mapping(address => uint256) Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb; mapping (address => mapping (address => uint256)) Ox52dbedeb4076f50de93275011c636bbe557fe366; }contract ReserveToken is Ox4c74b0cb1c912d9f6ddbcf473be14b67ae6c42b8, Ox9ddd03cfebe313ba94fe900223329b3354dcc32b { function ReserveToken() { s2c.minter = msg.sender; } function create(address account, uint amount) { if (msg.sender != s2c.minter) throw; Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[account] = safeAdd(Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[account], amount); s2c.Oxbc4c013090dcdd0d919102992e480603c6d7b075 = safeAdd(s2c.Oxbc4c013090dcdd0d919102992e480603c6d7b075, amount); } function destroy(address account, uint amount) { if (msg.sender != s2c.minter) throw; if (Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[account] < amount) throw; Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[account] = safeSub(Ox8b4a5e738d2638135cb6ec50ae5fa85fb40ee5fb[account], amount); s2c.Oxbc4c013090dcdd0d919102992e480603c6d7b075 = safeSub(s2c.Oxbc4c013090dcdd0d919102992e480603c6d7b075, amount); }}contract AccountLevels { function accountLevel(address user) constant returns(uint) {}}contract AccountLevelsTest is AccountLevels { mapping (address => uint) public accountLevels; function setAccountLevel(address user, uint level) { accountLevels[user] = level; } function accountLevel(address user) constant returns(uint) { return accountLevels[user]; }}contract Ethmall is Ox9ddd03cfebe313ba94fe900223329b3354dcc32b { mapping (address => mapping (address => uint)) public tokens; mapping (address => mapping (bytes32 => bool)) public orders; mapping (address => mapping (bytes32 => uint)) public orderFills; event Order(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user); event Cancel(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s); event Trade(address tokenGet, uint amountGet, address tokenGive, uint amountGive, address get, address give); event Deposit(address token, address user, uint amount, uint Ox0197f6b08d7f63ce9af55e1682937d27d0e742a5); event Withdraw(address token, address user, uint amount, uint Ox0197f6b08d7f63ce9af55e1682937d27d0e742a5); function Ethmall(address admin_, address feeAccount_, address accountLevelsAddr_, uint feeMake_, uint feeTake_, uint feeRebate_) { s2c.admin = admin_; s2c.feeAccount = feeAccount_; s2c.accountLevelsAddr = accountLevelsAddr_; s2c.feeMake = feeMake_; s2c.feeTake = feeTake_; s2c.feeRebate = feeRebate_; } function() { throw; } function changeAdmin(address admin_) { if (msg.sender != s2c.admin) throw; s2c.admin = admin_; } function changeAccountLevelsAddr(address accountLevelsAddr_) { if (msg.sender != s2c.admin) throw; s2c.accountLevelsAddr = accountLevelsAddr_; } function changeFeeAccount(address feeAccount_) { if (msg.sender != s2c.admin) throw; s2c.feeAccount = feeAccount_; } function changeFeeMake(uint feeMake_) { if (msg.sender != s2c.admin) throw; if (feeMake_ > s2c.feeMake) throw; s2c.feeMake = feeMake_; } function changeFeeTake(uint feeTake_) { if (msg.sender != s2c.admin) throw; if (feeTake_ > s2c.feeTake || feeTake_ < s2c.feeRebate) throw; s2c.feeTake = feeTake_; } function changeFeeRebate(uint feeRebate_) { if (msg.sender != s2c.admin) throw; if (feeRebate_ < s2c.feeRebate || feeRebate_ > s2c.feeTake) throw; s2c.feeRebate = feeRebate_; } function deposit() payable { tokens[0][msg.sender] = safeAdd(tokens[0][msg.sender], msg.Ox226624a5248127d25b5b2a4a86ab4db4a0194b89); Deposit(0, msg.sender, msg.Ox226624a5248127d25b5b2a4a86ab4db4a0194b89, tokens[0][msg.sender]); } function withdraw(uint amount) { if (tokens[0][msg.sender] < amount) throw; tokens[0][msg.sender] = safeSub(tokens[0][msg.sender], amount); if (!msg.sender.call.Ox226624a5248127d25b5b2a4a86ab4db4a0194b89(amount)()) throw; Withdraw(0, msg.sender, amount, tokens[0][msg.sender]); } function depositToken(address token, uint amount) { if (token==0) throw; if (!Token(token).Ox0029c064b3534a5b521718c1c0a2871f14814bc9(msg.sender, this, amount)) throw; tokens[token][msg.sender] = safeAdd(tokens[token][msg.sender], amount); Deposit(token, msg.sender, amount, tokens[token][msg.sender]); } function withdrawToken(address token, uint amount) { if (token==0) throw; if (tokens[token][msg.sender] < amount) throw; tokens[token][msg.sender] = safeSub(tokens[token][msg.sender], amount); if (!Token(token).Ox5b711cb427875f377563639a8ae06938b559fb07(msg.sender, amount)) throw; Withdraw(token, msg.sender, amount, tokens[token][msg.sender]); } function Oxab222344dad4862728db0dfd7feec8c4dfac26dd(address token, address user) constant returns (uint) { return tokens[token][user]; } function order(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); orders[msg.sender][hash] = true; Order(tokenGet, amountGet, tokenGive, amountGive, expires, nonce, msg.sender); } function trade(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s, uint amount) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); if (!( (orders[user][hash] || ecrecover(sha3("\x19Ethereum Signed Message:\n32", hash),v,r,s) == user) && block.number <= expires && safeAdd(orderFills[user][hash], amount) <= amountGet )) throw; tradeBalances(tokenGet, amountGet, tokenGive, amountGive, user, amount); orderFills[user][hash] = safeAdd(orderFills[user][hash], amount); Trade(tokenGet, amount, tokenGive, amountGive * amount / amountGet, user, msg.sender); } function tradeBalances(address tokenGet, uint amountGet, address tokenGive, uint amountGive, address user, uint amount) private { uint feeMakeXfer = safeMul(amount, s2c.feeMake) / (1 ether); uint feeTakeXfer = safeMul(amount, s2c.feeTake) / (1 ether); uint feeRebateXfer = 0; if (s2c.accountLevelsAddr != 0x0) { uint accountLevel = AccountLevels(s2c.accountLevelsAddr).accountLevel(user); if (accountLevel==1) feeRebateXfer = safeMul(amount, s2c.feeRebate) / (1 ether); if (accountLevel==2) feeRebateXfer = feeTakeXfer; } tokens[tokenGet][msg.sender] = safeSub(tokens[tokenGet][msg.sender], safeAdd(amount, feeTakeXfer)); tokens[tokenGet][user] = safeAdd(tokens[tokenGet][user], safeSub(safeAdd(amount, feeRebateXfer), feeMakeXfer)); tokens[tokenGet][s2c.feeAccount] = safeAdd(tokens[tokenGet][s2c.feeAccount], safeSub(safeAdd(feeMakeXfer, feeTakeXfer), feeRebateXfer)); tokens[tokenGive][user] = safeSub(tokens[tokenGive][user], safeMul(amountGive, amount) / amountGet); tokens[tokenGive][msg.sender] = safeAdd(tokens[tokenGive][msg.sender], safeMul(amountGive, amount) / amountGet); } function testTrade(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s, uint amount, address sender) constant returns(bool) { if (!( tokens[tokenGet][sender] >= amount && availableVolume(tokenGet, amountGet, tokenGive, amountGive, expires, nonce, user, v, r, s) >= amount )) return false; return true; } function availableVolume(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s) constant returns(uint) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); if (!( (orders[user][hash] || ecrecover(sha3("\x19Ethereum Signed Message:\n32", hash),v,r,s) == user) && block.number <= expires )) return 0; uint available1 = safeSub(amountGet, orderFills[user][hash]); uint available2 = safeMul(tokens[tokenGive][user], amountGet) / amountGive; if (available1<available2) return available1; return available2; } function amountFilled(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, address user, uint8 v, bytes32 r, bytes32 s) constant returns(uint) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); return orderFills[user][hash]; } function cancelOrder(address tokenGet, uint amountGet, address tokenGive, uint amountGive, uint expires, uint nonce, uint8 v, bytes32 r, bytes32 s) { bytes32 hash = sha256(this, tokenGet, amountGet, tokenGive, amountGive, expires, nonce); if (!(orders[msg.sender][hash] || ecrecover(sha3("\x19Ethereum Signed Message:\n32", hash),v,r,s) == msg.sender)) throw; orderFills[msg.sender][hash] = amountGet; Cancel(tokenGet, amountGet, tokenGive, amountGive, expires, nonce, msg.sender, v, r, s); }struct scalar2Vector {uint256 feeRebate;uint256 feeTake;uint256 feeMake;address accountLevelsAddr;address feeAccount;address admin;address minter;uint256 Oxbc4c013090dcdd0d919102992e480603c6d7b075;uint256 Oxdacb4af2460a733fbf47da190df25ca9a794cc73;}scalar2Vector s2c = scalar2Vector(0, 0, 0, address(0), address(0), address(0), address(0), 0, 0);}